\addchap{Приложение А}

\captionsetup{singlelinecheck=false, justification=raggedright}
\begin{lstlisting}[language=sql, caption=Создание и заполнение базы данных]
create database sosedushka_db;

create table sosedushka_db.user(
	tgName varchar(30) primary key,
	geoLat double precision,
	geoLong double precision,
	customerRole boolean, 
	executorRole boolean, 
	administratorRole boolean,
	adminVerified boolean
);
copy sosedushka_db.user (tgName, geoLat, geoLong, customerRole, 
	executorRole, administratorRole, adminVerified) 
	from '/tmp/db_course/user.csv'
	with delimiter ',';

create table sosedushka_db.connection(
	userTgName varchar(30) references sosedushka_db.user (tgName),
	currentRole varchar(15),
	primary key (userTgName, currentRole)
);
copy sosedushka_db.connection (userTgName, currentRole)
	from '/tmp/db_course/connection.csv'
	with delimiter ',';

create table sosedushka_db.skill(
	id int generated by default as identity 
	(start with 1 increment by 1) primary key,
	name text not null
);
copy sosedushka_db.skill (name) 
	from '/tmp/db_course/skill.csv'
	with delimiter ',';

create table sosedushka_db.executorSkill(
	executorId varchar(30) references sosedushka_db.user (tgName), 
	skillId int references sosedushka_db.skill (id),
	skillStatus varchar(20),
	primary key (executorId, skillId)
);
copy sosedushka_db.executorSkill (executorId, skillId, skillStatus) 
	from '/tmp/db_course/executorSkill.csv'
	with delimiter ',';

create table sosedushka_db.equipment (
	id int generated by default as identity 
	(start with 1 increment by 1) primary key,
	name text
);
copy sosedushka_db.equipment (name) 
	from '/tmp/db_course/equipment.csv'
	with delimiter ',';

create table sosedushka_db.request(
	id int generated by default as identity 
	(start with 1 increment by 1) primary key,
	title text not null,
	periodOfRelevance timestamp,
	explanation text,
	profNecessity int references sosedushka_db.skill (id),
	equipment int references sosedushka_db.equipment (id),
	owner varchar(30) references sosedushka_db.user (tgName),
	executor varchar(30) references sosedushka_db.user (tgName),
	status varchar(20)
);
copy sosedushka_db.request (title, periodOfRelevance, explanation, 	
	profNecessity, equipment, owner, executor, status)
	from '/tmp/db_course/request.csv'
	(format csv, null '');

create table sosedushka_db.ban(
	word text not null primary key
);
copy sosedushka_db.ban (word)
	from '/tmp/db_course/ban.csv'
	with delimiter ',';
	

create role customer with login password '1111';
grant insert, update on table sosedushka_db.user to customer;
grant insert, update on table sosedushka_db.connection to customer;
grant all privileges on table sosedushka_db.request to customer;
grant insert on table sosedushka_db.skill to customer;
grant insert on table sosedushka_db.equipment to customer;

create role executor with login password '2222';
grant insert, update on table sosedushka_db.user to executor;
grant insert, update on table sosedushka_db.connection to executor;
grant select, update on table sosedushka_db.request to executor;
grant insert on table sosedushka_db.skill to executor;
grant insert on table sosedushka_db.executorskill to executor;

create role administrator with login password '4813';
grant all privileges on table sosedushka_db.user to administrator;
grant all privileges on table sosedushka_db.connection to administrator;
grant all privileges on table sosedushka_db.executorskill to
administrator;
grant all privileges on table sosedushka_db.ban to administrator;
\end{lstlisting}
\captionsetup{singlelinecheck=false, justification=centering}